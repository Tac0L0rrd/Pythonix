<!DOCTYPE html>
<html>
<head>
    <title>LootLocker Debug Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #000; color: #0f0; }
        button { padding: 10px; margin: 10px; background: #333; color: #0f0; border: 1px solid #0f0; }
        .log { background: #111; padding: 10px; margin: 10px; border: 1px solid #333; max-height: 400px; overflow-y: auto; }
        .error { color: #f00; }
        .success { color: #0f0; }
        .info { color: #ff0; }
    </style>
</head>
<body>
    <h1>🔧 LootLocker API Debug Test</h1>
    
    <div>
        <button onclick="testGuestSession()">Test Guest Session</button>
        <button onclick="testLeaderboard()">Test Get Leaderboard</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div id="log" class="log">
        <h3>Debug Log:</h3>
        <div id="logContent"></div>
    </div>

    <script>
        const LOOTLOCKER_CONFIG = {
            gameApiKey: "dev_4ee5502534d5420f920ea3c675c1a5f8",
            leaderboardId: "31940",
            baseUrl: "https://api.lootlocker.io"
        };

        let sessionToken = null;

        function log(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const time = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logContent.innerHTML += `<div class="${className}">[${time}] ${message}</div>`;
            logContent.scrollTop = logContent.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('logContent').innerHTML = '';
        }

        async function testGuestSession() {
            try {
                log('🔐 Testing LootLocker Guest Session...', 'info');
                
                const url = `${LOOTLOCKER_CONFIG.baseUrl}/game/v2/session/guest`;
                const data = {
                    "game_key": LOOTLOCKER_CONFIG.gameApiKey,
                    "game_version": "1.0.0",
                    "player_identifier": "DebugPlayer"
                };
                
                log(`📤 POST ${url}`, 'info');
                log(`📋 Request data: ${JSON.stringify(data, null, 2)}`, 'info');
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });
                
                log(`📥 Response status: ${response.status} ${response.statusText}`, 'info');
                
                const result = await response.json();
                log(`📋 Response data: ${JSON.stringify(result, null, 2)}`, 'info');
                
                if (response.ok && result.success) {
                    sessionToken = result.session_token;
                    log('✅ Guest session successful!', 'success');
                    log(`🔑 Session token: ${sessionToken.substring(0, 20)}...`, 'success');
                } else {
                    log(`❌ Guest session failed: ${result.message || 'Unknown error'}`, 'error');
                }
                
            } catch (error) {
                log(`❌ Network error: ${error.message}`, 'error');
            }
        }

        async function testLeaderboard() {
            try {
                log('📊 Testing LootLocker Leaderboard...', 'info');
                
                // First ensure we have a session
                if (!sessionToken) {
                    log('🔐 No session token, creating session first...', 'info');
                    await testGuestSession();
                }
                
                if (!sessionToken) {
                    log('❌ Cannot test leaderboard without session token', 'error');
                    return;
                }
                
                const url = `${LOOTLOCKER_CONFIG.baseUrl}/game/leaderboards/${LOOTLOCKER_CONFIG.leaderboardId}/list`;
                
                log(`📤 GET ${url}`, 'info');
                log(`🔑 Using session token: ${sessionToken.substring(0, 20)}...`, 'info');
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        "Content-Type": "application/json",
                        "x-session-token": sessionToken
                    }
                });
                
                log(`📥 Response status: ${response.status} ${response.statusText}`, 'info');
                
                const result = await response.json();
                log(`📋 Response data: ${JSON.stringify(result, null, 2)}`, 'info');
                
                if (response.ok && result.success) {
                    log('✅ Leaderboard fetch successful!', 'success');
                    log(`📊 Found ${result.items ? result.items.length : 0} scores`, 'success');
                } else {
                    log(`❌ Leaderboard fetch failed: ${result.message || 'Unknown error'}`, 'error');
                }
                
            } catch (error) {
                log(`❌ Network error: ${error.message}`, 'error');
            }
        }

        // Auto-run tests on load
        window.onload = () => {
            log('🚀 LootLocker Debug Tool Loaded', 'info');
            log('Click buttons above to test API calls', 'info');
        };
    </script>
</body>
</html>